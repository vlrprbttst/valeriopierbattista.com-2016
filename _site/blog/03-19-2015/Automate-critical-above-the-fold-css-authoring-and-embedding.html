<!DOCTYPE html><!--[if IE 9]><html lang="en" class="ie ie9"><![endif]--><!--[if lt IE 9]><html lang="en" class="ie ie-legacy"><![endif]--><html lang="en"><head><meta charset="utf-8"><title>Valerio Pierbattista - Front End Web Developer</title><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><meta name="description" content="Valerio Pierbattista - Front End Web Developer from Rome, Italy.
		I love simple and functional interfaces optimized for anything that can access the web."><link href="http://fonts.googleapis.com/css?family=Source+Code+Pro|Merriweather:400,700" rel="stylesheet" type="text/css"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet" type="text/css"><meta property="og:title" content="Valerio Pierbattista - Front End Web Developer"><meta property="og:type" content="website"><meta property="og:url" content="http://www.valeriopierbattista.com"><meta property="og:image" content="http://www.valeriopierbattista.com/images/dist/facebook-image.png"><meta property="og:description" content="Front End Web Developer from Rome, Italy. I love simple and functional interfaces optimized for anything that can access the web."><meta property="og:site_name" content="http://valeriopierbattista.com/"><meta http-equiv="content-language" content="EN"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script><![endif]--></head><body class="container"><div id="info_cookie" style="display:none" class="cookie-hidden">Questo sito raccoglie dati statistici anonimi sulla navigazione, mediante cookie installati da terze parti autorizzate, rispettando la privacy dei tuoi dati personali e secondo le norme previste dalla legge. Continuando a navigare su questo sito accetti il servizio e gli stessi cookie.<br><div class="ok-cookie cookie-btn"><i class="fa fa-thumbs-up"></i> ok</div><div class="cookie-policy cookie-btn"><a href="cookies.php">cookie policy</a></div></div><div class="this-sidebar"><i id="bars" class="fa fa-bars"></i><div class="sub-container-sidebar"><section itemscope itemtype="http://data-vocabulary.org/Person"><span itemprop="name" class="name">Valerio Pierbattista</span><br><span itemprop="title" class="job"><code>Front end web developer</code></span></section></div><nav class="nav"><ul><li><a href="/index.html"><i class="fa fa-user"></i> About</a></li><li><a href="/work.html"><i class="fa fa-code"></i> Work</a></li><li><a href="/blog"><i class="fa fa-pencil"></i> Blog</a></li><li><a href="/contact.html"><i class="fa fa-send-o"></i> Contact</a></li></ul></nav></div><div class="page-container"><div class="sub-container blog blog-post"><h1>Blog</h1><div class="entry"><p><img src="/images/blog/penthouse.jpg" alt="penthouse"></p><p>We all know the best way to serve our website to our audience is to serve it <strong>fast</strong>, as fast as humanly possible. A couple of key factors for speed are how you serve css and javascript in your page. One thing Google suggests to do is to inline in the <code class="language-markup">head</code> of your document the “<strong>above the fold</strong>” css, which translates to all the css that paint what users see first when accessing your website: the header, the menu, the main content… The footer is clearly <strong>not</strong>above-the-fold material for example. Talking about performance, when testing your page speed on Google’s <a href="https://developers.google.com/speed/pagespeed/insights/" title="PageSpeed Insights tool" target="_blank">PageSpeed Insights tool</a>, you probably came across this warning at some point: <img src="/images/blog/abovethefold.png" alt="abovethefold" style="max-width:460px;display:block;margin:0 auto 20px"></p><h2>Eliminate render-blocking JavaScript and CSS in above the fold content</h2><p>There are many ways to do this and the one I prefer is using a grunt plugin called <a href="https://www.npmjs.com/package/grunt-penthouse" title="grunt-penthouse" target="_blank">penthouse</a>. Penthouse automatically extracts the above the fold css in a separate file, which you can later embed in the <code class="language-markup">head</code> of your documents either manually, or automatically.</p><h2>Setup</h2><p>Setting it up is pretty easy. Same old</p><pre><code class="language-shell">npm install grunt-penthouse --save-dev</code></pre><p>from the shell in the root of your project, enable it in your gruntfile with</p><pre><code class="language-javascript">grunt.loadNpmTasks('grunt-penthouse');</code></pre><p>and create a task like the following:</p><pre class="language-javascript"><code>penthouse: {
    extract : {
        outfile : 'css/critical.css',
        css : 'css/main.css',
        url : 'http://localhost/your-website',
        width : 1200,
        height : 500
    },
  },
</code></pre><p>I automate the creation of this file everytime my css file changes. I use sass for css authoring, so my watch part of the gruntfile looks something like</p><pre class="language-javascript"><code>css : {
  files : ['sass/**/*.scss'],
  tasks : ['sass', 'autoprefixer', 'penthouse'],
  options : {
    spawn : false,
    }
 },</code></pre><p>You clearly see how this tasks chain work: sass compiles <code class="language-markup">main.css</code> <i class="fa fa-long-arrow-right"></i> <code class="language-markup">main.css</code> gets autoprefixed <i class="fa fa-long-arrow-right"></i> <code class="language-markup">critical.css</code> with the above the fold styles is produced.</p><h2>Embedding</h2><p>What should we do with <code class="language-markup">critical.css</code>? Open it, copy the content and paste it in the <code class="language-markup">head</code> section of all of our pages? That’s tedious, no way this is maintainable. There’s a way to automate this if your project is made in <code class="language-markup">php</code> or any other language that can use <strong>includes</strong>. I use <code class="language-markup">php</code> so the way I automate this is hacking the file extension of the <code class="language-markup">critical.css</code> file into <code class="language-markup">critical.css.php</code> in the grunt task and then I include it in every page like this:</p><pre class="language-markup"><code class="language-markup">&lt;style type="text/css"&gt;
  &lt;?php include 'css/critical.css.php';?&gt;
&lt;/style&gt;</code>
</pre><p>This way the embedding is automatic and always up-to-date and you won’t have to worry about anything. You can now safely move the <code class="language-markup">main.css</code> file at the bottom of the page. Team this up with <a href="http://www.feedthebot.com/pagespeed/defer-loading-javascript.html" target="_blank">deferring javascript</a> and you’ll easily get ~10 points on the pagespeed score.</p><p>One bad thing about this approach is that, if you have linked images in the above the fold css, the paths won’t be updated and effective.</p><p class="sharethis">Share this:</p><div class="social-cont"><div class="social-box facebook"><a href="https://facebook.com/sharer.php?u=/blog/03-19-2015/Automate-critical-above-the-fold-css-authoring-and-embedding.html" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa social-ico fa-facebook"></i></a></div><div class="social-box twitter"><a href="https://twitter.com/intent/tweet?text=Automate Critical Above The Fold Css Authoring And Embedding&url=/blog/03-19-2015/Automate-critical-above-the-fold-css-authoring-and-embedding.html&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa social-ico fa-twitter"></i></a></div><div class="social-box linkedin"><a href="http://www.linkedin.com/shareArticle?mini=true&url=/blog/03-19-2015/Automate-critical-above-the-fold-css-authoring-and-embedding.html&title=Automate Critical Above The Fold Css Authoring And Embedding&source=" target="_blank"><i class="fa social-ico fa-linkedin"></i></a></div></div></div></div></div><footer class="footer"><div class="sub-container-sidebar"><div class="site-info">Hand-Coded with <i class="fa fa-heart"></i> in Rome (Italy) using <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>, <a href="http://sass-lang.com/" target="_blank">Sass</a>, <a href="http://compass-style.org/" target="_blank">Compass</a>, <a href="http://jquery.com/" target="_blank">jQuery</a>, <a href="http://susy.oddbird.net/" target="_blank">Susy</a> and <a href="http://gruntjs.com/" target="_blank">Grunt</a>. // <a href="/cookies.html">Privacy and Cookie Policy</a></div><div class="footer-sep"></div><div class="social-cont"><div class="social-box email"><a href="mailto:omegaiori@gmail.com" target="_blank"><i class="fa social-ico fa-envelope"></i></a></div><div class="social-box twitter"><a href="https://twitter.com/vlrprbttst" target="_blank"><i class="fa social-ico fa-twitter"></i></a></div><div class="social-box youtube"><a href="https://www.youtube.com/user/valeriopierbattista" target="_blank"><i class="fa social-ico fa-youtube"></i></a></div><div class="social-box instagram"><a href="http://instagram.com/vlrprbttst" target="_blank"><i class="fa social-ico fa-instagram"></i></a></div><div class="social-box linkedin"><a href="https://www.linkedin.com/profile/view?trk=tab_pro&id=92711655" target="_blank"><i class="fa social-ico fa-linkedin"></i></a></div><div class="social-box github"><a href="http://github.com/vlrprbttst" target="_blank"><i class="fa social-ico fa-github"></i></a></div><div class="social-box codepen"><a href="http://codepen.io/vlrprbttst" target="_blank"><i class="fa social-ico fa-codepen"></i></a></div><div class="social-box cv"><a href="http://valeriopierbattista.com/cv" target="_blank"><i class="fa social-ico fa-file-text-o"></i></a></div></div></div></footer><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42737159-1', 'auto');
  ga('set', 'anonymizeIp', true);
  ga('send', 'pageview');</script><script src="/js/production.min.js"></script></body></html>